#include <stdint.h>
#include <stdio.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

uint32_t *NVIC_PRI = (uint32_t*)0xE000E400; // Priority register
uint32_t *NVIC_ISER = (uint32_t*)0xE000E100; // Interrupt Set-Enable register
uint32_t *NVIC_ISPR = (uint32_t*)0xE000E200; // Interrupt Pending register

#define WWDG         5
#define PVD          6

void configure_interrupts(uint32_t IN, uint32_t Ipri)
{
    // Find the Priority register
    uint32_t Pr = IN / 4;
    uint32_t pos = (IN % 4) * 8;
    uint32_t *ptr = NVIC_PRI + Pr;

    *ptr &= ~(0xFF << pos);  // Clear previous priority
    *ptr |= (Ipri << pos);   // Set new priority
}

int main()
{
    configure_interrupts(WWDG, 1);  // Configure Timer2 interrupt
    configure_interrupts(PVD, 2);    // Configure I2C1 interrupt

    // Set the interrupt enable bits
    *NVIC_ISER |= (1 << WWDG);
    *NVIC_ISER |= (1 << PVD);

    // Set pending register for TIMER2
    *NVIC_ISPR |= (1 << WWDG);

    return 0;
}

void UsageFault_Handler()
{
	printf("WWDG Handler \n");
}

void BusFault_Handler()
{
	printf("PVD Handler \n");
}
